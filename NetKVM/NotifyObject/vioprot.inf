;-------------------------------------------------------------------------
; VIOPROT.INF -- VirtIO NetKVM Protocol Driver
;
; Copyright (c) 2003, Microsoft Corporation
; Copyright (c) 2020 Oracle and/or its affiliates.
;-------------------------------------------------------------------------

[version]
Signature   = "$Windows NT$"
Class       = NetTrans
ClassGUID   = {4d36e975-e325-11ce-bfc1-08002be10318}
Provider    = %ProviderString%
DriverVer   = 07/16/2010,4.2
CatalogFile  = netkvm.cat


[Manufacturer]
%ManufacturerName%=Standard,NTx86,NTamd64

[Standard.NTx86]
%NDISPROT_Desc%=Install, VIOPROT

[Standard.NTamd64]
%NDISPROT_Desc%=Install, VIOPROT

;-------------------------------------------------------------------------
; Installation Section
;-------------------------------------------------------------------------
[Install]
AddReg=Inst_Ndi
Characteristics=0x0 ;
CopyFiles=CpyFiles_Dll

;-------------------------------------------------------------------------
; Ndi installation support
;-------------------------------------------------------------------------
[Inst_Ndi]
HKR, Ndi, ClsID, 0, {5a3db745-e424-4402-a575-af5e4bc65b1d}
HKR, Ndi, ComponentDll, , netkvmno.dll
HKR,Ndi,Service,,"Ndisprot"
HKR,Ndi,HelpText,,%NDISPROT_HelpText%
HKR,Ndi\Interfaces, UpperRange,, noupper
HKR,"Ndi\Interfaces","LowerRange",,"ndis5,ndis4,ndis5_prot"

;-------------------------------------------------------------------------
; Service installation support
;-------------------------------------------------------------------------
[Install.Services]
AddService=Ndisprot,,NDISPROT_Service_Inst,NDISPROT_AddEventLog

[NDISPROT_Service_Inst]
DisplayName     = %NDISPROT_Desc%
ServiceType     = 1 ;SERVICE_KERNEL_DRIVER
StartType       = 3 ;SERVICE_DEMAND_START
ErrorControl    = 1 ;SERVICE_ERROR_NORMAL
ServiceBinary   = %12%\netkvm.sys
Description     = %NDISPROT_Desc%

[NDISPROT_AddEventLog]
AddReg = NDISPROT_AddEventLog_AddReg

[NDISPROT_AddEventLog_AddReg]
HKR, , EventMessageFile, 0x20000, "%%SystemRoot%%\System32\netevent.dll"
HKR, , TypesSupported,   0x10001, 7

[Install.Remove.Services]
DelService=Ndisprot,0x200

;-------------------------------------------------------------------------
; Declare Destination Directories for file copy/deletion
;-------------------------------------------------------------------------
[SourceDisksNames]
1=%DiskDescription%,"",,

[SourceDisksFiles]
netkvmno.dll=1

[DestinationDirs]
CpyFiles_Dll    = 11    ; %windir%\System32

;-------------------------------------------------------------------------
; Files to Copy/Delete - Referenced by Install and Remove sections above
;-------------------------------------------------------------------------
[CpyFiles_Dll]
netkvmno.dll,,,2

[Strings]
ManufacturerName = "VirtIO"
ProviderString = "VirtIO"
DiskDescription = "VirtIO NetKVM Protocol Driver Disk"
NDISPROT_Desc = "VirtIO NetKVM Protocol Driver"
NDISPROT_HelpText = "A driver to support SRIOV for VirtIO network devices"
